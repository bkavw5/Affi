<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>RoPhim - Phim hay cả rổ - Xem Phim Mới HD Online Vietsub</title>
    <meta name="description" content="Xem phim online miễn phí, chất lượng cao với dữ liệu từ KKPhim.VIP. Phim mới cập nhật liên tục, hỗ trợ Vietsub, Lồng Tiếng, Thuyết Minh." />
    <link rel="preconnect" href="https://phimapi.com">
    <link rel="preconnect" href="https://phimimg.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0a0a0a;
            --panel: #1a1a1a;
            --accent: #e50914;
            --accent-hover: #ff0a16;
            --muted: #aaa;
            --text: #fff;
            --card-radius: 8px;
            --transition: all 0.3s ease;
            --header-height: 70px;
            --section-spacing: 30px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: var(--header-height);
        }

        /* Header Styles */
        header {
            background: rgba(20, 20, 20, 0.95);
            padding: 0 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #2a2a2a;
        }

        #logo {
            display: flex;
            align-items: center;
        }

        #logo img {
            height: 40px;
            transition: var(--transition);
        }

        #logo img:hover {
            transform: scale(1.05);
        }

        #searchContainer {
            flex: 1;
            position: relative;
            max-width: 600px;
            margin: 0 20px;
        }

        #searchInput {
            width: 100%;
            padding: 12px 20px;
            border-radius: 30px;
            border: none;
            background: #222;
            color: var(--text);
            font-size: 16px;
            transition: var(--transition);
            outline: none;
            padding-right: 50px;
        }

        #searchInput:focus {
            background: #2a2a2a;
            box-shadow: 0 0 0 2px var(--accent);
        }

        #searchBtn {
            position: absolute;
            right: 5px;
            top: 5px;
            padding: 7px 16px;
            border-radius: 30px;
            border: none;
            background: var(--accent);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        #searchBtn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-icon {
            font-size: 20px;
            color: var(--text);
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-icon:hover {
            color: var(--accent);
        }

        /* Hero Banner */
        .hero-banner {
            height: 500px;
            position: relative;
            overflow: hidden;
            border-radius: var(--card-radius);
            margin: 20px 0 var(--section-spacing);
        }

        .hero-banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 30px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            z-index: 2;
        }

        .hero-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .hero-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .hero-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .hero-description {
            max-width: 600px;
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .hero-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Category Navigation */
        .category-nav {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 15px 0;
            margin-bottom: var(--section-spacing);
            scrollbar-width: none;
        }

        .category-nav::-webkit-scrollbar {
            display: none;
        }

        .category-item {
            padding: 8px 20px;
            background: var(--panel);
            border-radius: 30px;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .category-item:hover,
        .category-item.active {
            background: var(--accent);
            color: white;
        }

        /* Main Content */
        main {
            padding: 0 20px 80px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: var(--section-spacing) 0 20px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .view-all {
            color: var(--accent);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .view-all:hover {
            text-decoration: underline;
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .movie-card {
            background: var(--panel);
            border-radius: var(--card-radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        .movie-poster {
            width: 100%;
            height: 270px;
            object-fit: cover;
            display: block;
            loading: lazy;
        }

        .movie-info {
            padding: 15px;
        }

        .movie-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 2.8rem;
        }

        .movie-meta {
            display: flex;
            justify-content: space-between;
            color: var(--muted);
            font-size: 0.85rem;
        }

        .movie-rating {
            display: flex;
            align-items: center;
            gap: 3px;
            color: #ffc107;
        }

        .movie-year {
            color: var(--muted);
        }

        .movie-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--accent);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Popup Styles */
        .popup {
            position: fixed;
            inset: 0;
            display: none;
            justify-content: center;
            align-items: flex-start;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
            padding: 40px 20px;
            animation: fadeIn 0.3s ease;
        }

        .popup-content {
            width: 100%;
            max-width: 1000px;
            background: transparent;
            display: flex;
            flex-direction: column;
            animation: scaleIn 0.3s ease;
        }

        .player-container {
            width: 100%;
            background: black;
            border-radius: var(--card-radius);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            aspect-ratio: 16/9;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: 0;
            display: block;
        }

        .popup-body {
            display: flex;
            gap: 24px;
            padding: 24px;
            flex-wrap: wrap;
            background: linear-gradient(rgba(0, 0, 0, 0.9), rgba(30, 30, 30, 0.8));
            border-radius: 0 0 var(--card-radius) var(--card-radius);
            backdrop-filter: blur(10px);
        }

        .popup-body img {
            width: 280px;
            border-radius: var(--card-radius);
            object-fit: cover;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .popup-info {
            flex: 1;
            min-width: 300px;
        }

        .popup-info h3 {
            margin: 0 0 12px;
            font-size: 1.8rem;
            line-height: 1.3;
        }

        .popup-meta {
            color: var(--muted);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .popup-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            margin: 12px 0;
        }

        .share-buttons button {
            padding: 8px 16px;
            background: #2a2a2a;
            border-radius: 6px;
            border: none;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .share-buttons button:hover {
            background: var(--accent);
        }

        .desc {
            color: #ddd;
            margin-top: 16px;
            font-size: 0.95rem;
            line-height: 1.6;
            max-height: 120px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .desc.expanded {
            max-height: 1000px;
        }

        .toggle-btn {
            margin-top: 12px;
            padding: 8px 16px;
            background: #2a2a2a;
            border-radius: 6px;
            border: none;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-btn:hover {
            background: #333;
        }

        .episodes {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .episodes button {
            padding: 10px;
            background: #222;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .episodes button:hover {
            background: var(--accent);
        }

        .episodes button.active {
            background: var(--accent);
        }

        .close-btn {
            position: fixed;
            right: 24px;
            top: 24px;
            font-size: 32px;
            color: white;
            cursor: pointer;
            z-index: 2100;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-btn:hover {
            background: var(--accent);
            transform: rotate(90deg);
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Back to top button */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 999;
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.3);
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--accent-hover);
            transform: translateY(-5px);
        }

        /* Footer Styles */
        footer {
            background: #111;
            color: var(--muted);
            padding: 50px 20px 30px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-column h3 {
            color: var(--text);
            margin-bottom: 20px;
            font-size: 1.2rem;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--accent);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--muted);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: var(--accent);
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 40px auto 0;
            padding-top: 20px;
            border-top: 1px solid #333;
            text-align: center;
            font-size: 0.9rem;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #222;
            color: var(--text);
            transition: var(--transition);
        }

        .social-links a:hover {
            background: var(--accent);
            transform: translateY(-3px);
        }

        .telegram-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #0088cc;
            border-radius: 6px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .telegram-link:hover {
            background: #00aaff;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.95);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Responsive Styles */
        @media (max-width: 1200px) {
            .movie-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        @media (max-width: 992px) {
            .hero-banner {
                height: 400px;
            }

            .hero-title {
                font-size: 2rem;
            }

            .popup-body {
                flex-direction: column;
                align-items: center;
            }

            .popup-body img {
                width: 220px;
            }

            .player-container,
            iframe {
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            :root {
                --header-height: 60px;
            }

            header {
                padding: 0 15px;
            }

            #searchContainer {
                margin: 0 10px;
            }

            .hero-banner {
                height: 350px;
            }

            .hero-title {
                font-size: 1.8rem;
            }

            .hero-content {
                padding: 20px;
            }

            .movie-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }

            .movie-poster {
                height: 220px;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .nav-menu {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .hero-banner {
                height: 300px;
            }

            .hero-title {
                font-size: 1.5rem;
            }

            .hero-description {
                font-size: 0.9rem;
            }

            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .movie-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .movie-poster {
                height: 200px;
            }

            .section-title {
                font-size: 1.3rem;
            }

            .player-container,
            iframe {
                height: 250px;
            }

            .popup-body img {
                width: 180px;
            }

            .popup-info h3 {
                font-size: 1.5rem;
            }

            .episodes {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }

            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div id="logo">
            <img src="https://i.imgur.com/NEqqdDt.png" alt="RoPhim Logo" />
        </div>
        <div id="searchContainer">
            <input id="searchInput" placeholder="Tìm kiếm phim..." />
            <button id="searchBtn"><i class="fas fa-search"></i></button>
        </div>
        <div class="nav-menu">
            <a href="#" class="nav-icon"><i class="fas fa-heart"></i></a>
            <a href="#" class="nav-icon"><i class="fas fa-bell"></i></a>
            <a href="#" class="nav-icon"><i class="fas fa-user"></i></a>
        </div>
    </header>

    <main>
        <!-- Hero Banner -->
        <div class="hero-banner" id="heroBanner">
            <img src="https://via.placeholder.com/1600x500/333/fff?text=Phim+Noi+Bat" alt="Featured Movie">
            <div class="hero-content">
                <h2 class="hero-title">Phim nổi bật</h2>
                <div class="hero-meta">
                    <span><i class="fas fa-star"></i> 8.0/10</span>
                    <span><i class="fas fa-clock"></i> N/A</span>
                    <span><i class="fas fa-calendar"></i> N/A</span>
                    <span><i class="fas fa-film"></i> N/A</span>
                </div>
                <p class="hero-description">Không có mô tả cho phim này.</p>
                <div class="hero-actions">
                    <button class="btn btn-primary" onclick="getMovieDetail('')"><i class="fas fa-play"></i> Xem ngay</button>
                    <button class="btn btn-secondary"><i class="fas fa-plus"></i> Thêm vào danh sách</button>
                </div>
            </div>
        </div>

        <!-- Category Navigation -->
        <div class="category-nav">
            <div class="category-item active" data-filter="all">Tất cả</div>
            <div class="category-item" data-filter="category" data-value="hanh-dong">Hành động</div>
            <div class="category-item" data-filter="category" data-value="tinh-cam">Tình cảm</div>
            <div class="category-item" data-filter="category" data-value="hai-huoc">Hài hước</div>
            <div class="category-item" data-filter="category" data-value="kinh-di">Kinh dị</div>
            <div class="category-item" data-filter="category" data-value="vien-tuong">Viễn tưởng</div>
            <div class="category-item" data-filter="category" data-value="phieu-luu">Phiêu lưu</div>
            <div class="category-item" data-filter="category" data-value="hoat-hinh">Hoạt hình</div>
            <div class="category-item" data-filter="category" data-value="tai-lieu">Tài liệu</div>
            <div class="category-item" data-filter="type" data-value="phim-bo">Phim bộ</div>
            <div class="category-item" data-filter="type" data-value="phim-le">Phim lẻ</div>
            <div class="category-item" data-filter="country" data-value="viet-nam">Việt Nam</div>
            <div class="category-item" data-filter="country" data-value="han-quoc">Hàn Quốc</div>
            <div class="category-item" data-filter="country" data-value="trung-quoc">Trung Quốc</div>
            <div class="category-item" data-filter="country" data-value="thai-lan">Thái Lan</div>
        </div>

        <!-- Movies Sections -->
        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-fire"></i> Phim hot</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-hot"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-fist-raised"></i> Phim hành động</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-hd"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-heart"></i> Phim tình cảm</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-tc"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-ghost"></i> Phim kinh dị</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-kd"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-globe-asia"></i> Phim Việt Nam</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-viet"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-hat-cowboy"></i> Phim Âu Mỹ</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-anh"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-dragon"></i> Phim Trung Quốc</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-trung"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-fan"></i> Phim Hàn Quốc</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-han"></div>

        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-umbrella-beach"></i> Phim Thái Lan</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
        </div>
        <div class="movie-grid" id="movies-thai"></div>
    </main>

    <div class="back-to-top" id="backToTop"><i class="fas fa-chevron-up"></i></div>

    <!-- Popup -->
    <div id="popup" class="popup" role="dialog" aria-modal="true">
        <span class="close-btn" id="popupClose">×</span>
        <div class="popup-content">
            <div class="player-container" id="player">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="popup-body">
                <img id="moviePoster" src="" alt="Poster" />
                <div class="popup-info">
                    <h3 id="movieTitle">Tiêu đề</h3>
                    <div id="movieMeta" class="popup-meta"></div>
                    <div class="share-buttons">
                        <button onclick="shareTo('facebook')"><i class="fab fa-facebook-f"></i> Chia sẻ</button>
                        <button onclick="shareTo('twitter')"><i class="fab fa-twitter"></i> Chia sẻ</button>
                        <button onclick="downloadPoster()"><i class="fas fa-download"></i> Tải poster</button>
                        <button class="btn btn-secondary"><i class="fas fa-plus"></i> Thêm vào danh sách</button>
                    </div>
                    <div id="movieDesc" class="desc"></div>
                    <button id="toggleDescBtn" class="toggle-btn" style="display:none">Xem thêm▼</button>
                    <h4 style="margin-top:20px;">Danh sách tập</h4>
                    <div id="episodeList" class="episodes"></div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3>Giới thiệu</h3>
                <p>RoPhim cung cấp thông tin phim hot, cập nhật nhanh các thể loại phim đa dạng, sử dụng API từ KKPhim.VIP. Dữ liệu phim Vietsub, Lồng Tiếng, Thuyết Minh được cung cấp miễn phí và vĩnh viễn.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="https://t.me/phimnguon" class="telegram-link"><i class="fab fa-telegram-plane"></i> Tham gia Telegram</a>
                </div>
            </div>
            <div class="footer-column">
                <h3>Danh mục phim</h3>
                <ul class="footer-links">
                    <li><a href="#" data-filter="category" data-value="hanh-dong"><i class="fas fa-chevron-right"></i> Phim hành động</a></li>
                    <li><a href="#" data-filter="category" data-value="tinh-cam"><i class="fas fa-chevron-right"></i> Phim tình cảm</a></li>
                    <li><a href="#" data-filter="category" data-value="kinh-di"><i class="fas fa-chevron-right"></i> Phim kinh dị</a></li>
                    <li><a href="#" data-filter="category" data-value="phieu-luu"><i class="fas fa-chevron-right"></i> Phim phiêu lưu</a></li>
                    <li><a href="#" data-filter="category" data-value="vien-tuong"><i class="fas fa-chevron-right"></i> Phim viễn tưởng</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Quốc gia</h3>
                <ul class="footer-links">
                    <li><a href="#" data-filter="country" data-value="viet-nam"><i class="fas fa-chevron-right"></i> Phim Việt Nam</a></li>
                    <li><a href="#" data-filter="country" data-value="han-quoc"><i class="fas fa-chevron-right"></i> Phim Hàn Quốc</a></li>
                    <li><a href="#" data-filter="country" data-value="trung-quoc"><i class="fas fa-chevron-right"></i> Phim Trung Quốc</a></li>
                    <li><a href="#" data-filter="country" data-value="thai-lan"><i class="fas fa-chevron-right"></i> Phim Thái Lan</a></li>
                    <li><a href="#" data-filter="country" data-value="au-my"><i class="fas fa-chevron-right"></i> Phim Âu Mỹ</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Liên kết hữu ích</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-chevron-right"></i> Trang chủ</a></li>
                    <li><a href="#"><i class="fas fa-chevron-right"></i> Giới thiệu</a></li>
                    <li><a href="#"><i class="fas fa-chevron-right"></i> Điều khoản sử dụng</a></li>
                    <li><a href="#"><i class="fas fa-chevron-right"></i> Chính sách riêng tư</a></li>
                    <li><a href="#"><i class="fas fa-chevron-right"></i> Liên hệ</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Copyright &copy; 2025 RoPhim. All rights reserved.</p>
            <p>Disclaimer: This site does not store any files on its server. All contents are provided by non-affiliated third parties, particularly from KKPhim.VIP.</p>
        </div>
    </footer>

    <script>
        // Global variables
        let originalMainHtml = '';
        let isLoading = false;

        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function () {
            originalMainHtml = document.getElementById('main').innerHTML;
            initEventListeners();
            loadInitial();
        });

        // Initialize event listeners
        function initEventListeners() {
            // Search functionality
            document.getElementById('searchBtn').addEventListener('click', handleSearch);
            document.getElementById('searchInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') handleSearch();
            });

            // Category navigation
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', function () {
                    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    if (this.dataset.filter !== 'all') {
                        applyCategoryFilter(this.dataset.filter, this.dataset.value);
                    } else {
                        resetMainContent();
                    }
                });
            });

            // Popup functionality
            document.getElementById('popupClose').addEventListener('click', closePopup);
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') closePopup();
            });

            document.getElementById('popup').addEventListener('click', function (e) {
                if (e.target === this) closePopup();
            });

            // Back to top
            initBackToTop();
        }

        // Initialize back to top button
        function initBackToTop() {
            const backToTopBtn = document.getElementById('backToTop');
            window.addEventListener('scroll', function () {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            });

            backToTopBtn.addEventListener('click', function () {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        // Handle search
        function handleSearch() {
            const keyword = document.getElementById('searchInput').value.trim();
            if (!keyword) {
                alert('Vui lòng nhập từ khóa tìm kiếm.');
                return;
            }

            showLoading();
            searchMovies(keyword);
        }

        // Apply category filter
        async function applyCategoryFilter(filterType, filterValue) {
            showLoading();

            let apiUrl = '';
            if (filterType === 'category') {
                apiUrl = `https://phimapi.com/v1/api/the-loai/${filterValue}?page=1&limit=64`;
            } else if (filterType === 'country') {
                apiUrl = `https://phimapi.com/v1/api/quoc-gia/${filterValue}?page=1&limit=64`;
            } else if (filterType === 'type') {
                apiUrl = `https://phimapi.com/v1/api/danh-sach/${filterValue}?page=1&limit=64`;
            }

            try {
                const res = await fetch(apiUrl);
                const data = await res.json();
                const items = data?.data?.items || [];
                const cdn = data?.data?.APP_DOMAIN_CDN_IMAGE || 'https://phimimg.com';

                const main = document.getElementById('main');
                main.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-filter"></i> Kết quả: ${filterValue.replace(/-/g, ' ').toUpperCase()}</h2>
                        <button id="backHomeBtn" class="view-all">⏎ Quay về trang chủ</button>
                    </div>
                    <div class="movie-grid" id="filter-results"></div>
                `;

                renderMovies(items, 'filter-results', cdn);

                document.getElementById('backHomeBtn').addEventListener('click', resetMainContent);

            } catch (e) {
                console.error('Lỗi lọc phim', e);
                alert('Lỗi khi lọc phim, vui lòng thử lại.');
            } finally {
                hideLoading();
            }
        }

        // Reset main content
        function resetMainContent() {
            const main = document.getElementById('main');
            main.innerHTML = originalMainHtml;
            initEventListeners();
            loadInitial();
        }

        // Show loading state
        function showLoading() {
            if (isLoading) return;
            isLoading = true;

            const main = document.getElementById('main');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.innerHTML = '<div class="spinner"></div>';
            main.appendChild(loadingDiv);
        }

        // Hide loading state
        function hideLoading() {
            isLoading = false;
            const loadingElements = document.querySelectorAll('.loading');
            loadingElements.forEach(el => el.remove());
        }

        // Build image URL
        function buildImageUrl(path, cdnDomain = "https://phimimg.com") {
            if (!path) return "https://via.placeholder.com/300x440?text=No+Image";
            if (path.startsWith("http")) return path;
            return cdnDomain.replace(/\/+$/, "") + "/" + path.replace(/^\/+/, "");
        }

        // Download poster
        function downloadPoster() {
            const posterUrl = document.getElementById('moviePoster').src;
            if (!posterUrl || posterUrl.includes('placeholder')) {
                alert('Không có poster để tải.');
                return;
            }

            const link = document.createElement('a');
            link.href = posterUrl;
            link.download = 'movie-poster.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Render hero banner
        function renderHeroBanner(movie, cdnDomain = "https://phimimg.com") {
            const banner = document.getElementById('heroBanner');
            if (!banner) return;

            const imgPath = movie.poster_url || movie.thumb_url || "";
            const img = buildImageUrl(imgPath, cdnDomain);
            const safeName = (movie.name || movie.origin_name || "No title").replace(/"/g, "&quot;");
            const desc = (movie.content || "Không có mô tả.").substring(0, 150) + "...";
            const rating = movie.rating || Math.random() * 5 + 5;
            const year = movie.year || "N/A";
            const time = movie.time || "N/A";
            const quality = movie.quality || "N/A";

            banner.innerHTML = `
                <img src="${img}" alt="${safeName}">
                <div class="hero-content">
                    <h2 class="hero-title">${safeName}</h2>
                    <div class="hero-meta">
                        <span><i class="fas fa-star"></i> ${rating.toFixed(1)}/10</span>
                        <span><i class="fas fa-clock"></i> ${time}</span>
                        <span><i class="fas fa-calendar"></i> ${year}</span>
                        <span><i class="fas fa-film"></i> ${quality}</span>
                    </div>
                    <p class="hero-description">${desc}</p>
                    <div class="hero-actions">
                        <button class="btn btn-primary" onclick="getMovieDetail('${movie.slug}')"><i class="fas fa-play"></i> Xem ngay</button>
                        <button class="btn btn-secondary"><i class="fas fa-plus"></i> Thêm vào danh sách</button>
                    </div>
                </div>
            `;
        }

        // Render movies
        function renderMovies(movies, containerId, cdnDomain = "https://phimimg.com") {
            const el = document.getElementById(containerId);
            if (!el) return;

            if (movies.length === 0) {
                el.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--muted);">Không tìm thấy phim nào.</p>';
                return;
            }

            el.innerHTML = movies.map(m => {
                const imgPath = m.poster_url || m.thumb_url || "";
                const img = buildImageUrl(imgPath, cdnDomain);
                const safeName = (m.name || m.origin_name || "No title").replace(/"/g, "&quot;");
                const rating = m.rating || Math.random() * 5 + 5;
                const year = m.year || "N/A";
                const badge = m.is_hot ? "Hot" : m.is_new ? "New" : "";
                return `
                    <div class="movie-card" data-slug="${m.slug || ''}" onclick="getMovieDetail('${m.slug}')">
                        ${badge ? `<div class="movie-badge">${badge}</div>` : ''}
                        <img src="${img}" alt="${safeName}" class="movie-poster" loading="lazy">
                        <div class="movie-info">
                            <h3 class="movie-title">${safeName}</h3>
                            <div class="movie-meta">
                                <span class="movie-rating"><i class="fas fa-star"></i> ${rating.toFixed(1)}</span>
                                <span class="movie-year">${year}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join("");
        }

        // Load initial sections
        async function loadInitial() {
            showLoading();
            const endpoints = [
                { url: "https://phimapi.com/danh-sach/phim-moi-cap-nhat?page=1", container: "heroBanner", slice: 1, render: renderHeroBanner },
                { url: "https://phimapi.com/danh-sach/phim-moi-cap-nhat?page=1", container: "movies-hot", slice: 12 },
                { url: "https://phimapi.com/v1/api/the-loai/hanh-dong?page=1&limit=12", container: "movies-hd" },
                { url: "https://phimapi.com/v1/api/the-loai/tinh-cam?page=1&limit=12", container: "movies-tc" },
                { url: "https://phimapi.com/v1/api/the-loai/kinh-di?page=1&limit=12", container: "movies-kd" },
                { url: "https://phimapi.com/v1/api/quoc-gia/viet-nam?page=1&limit=12", container: "movies-viet" },
                { url: "https://phimapi.com/v1/api/quoc-gia/au-my?page=1&limit=12", container: "movies-anh" },
                { url: "https://phimapi.com/v1/api/quoc-gia/trung-quoc?page=1&limit=12", container: "movies-trung" },
                { url: "https://phimapi.com/v1/api/quoc-gia/han-quoc?page=1&limit=12", container: "movies-han" },
                { url: "https://phimapi.com/v1/api/quoc-gia/thai-lan?page=1&limit=12", container: "movies-thai" }
            ];

            const promises = endpoints.map(async ({ url, container, slice, render = renderMovies }) => {
                try {
                    const r = await fetch(url);
                    const d = await r.json();
                    const items = slice ? (d?.items || d?.data?.items || []).slice(0, slice) : (d?.data?.items || []);
                    const cdn = d?.APP_DOMAIN_CDN_IMAGE || d?.data?.APP_DOMAIN_CDN_IMAGE || "https://phimimg.com";
                    render(items, container, cdn);
                } catch (e) {
                    console.error(`Error loading ${container}`, e);
                }
            });

            await Promise.allSettled(promises);
            hideLoading();
        }

        // Search movies
        async function searchMovies(keyword) {
            if (!keyword) return;

            try {
                const r = await fetch(`https://phimapi.com/v1/api/tim-kiem?keyword=${encodeURIComponent(keyword)}&limit=64`);
                const d = await r.json();
                const items = d?.data?.items || [];
                const cdn = d?.data?.APP_DOMAIN_CDN_IMAGE || "https://phimimg.com";

                const main = document.getElementById("main");
                main.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-search"></i> Kết quả tìm kiếm: "${escapeHtml(keyword)}"</h2>
                        <button id="backHomeBtn" class="view-all">⏎ Quay về trang chủ</button>
                    </div>
                    <div class="movie-grid" id="search-results"></div>
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-fire"></i> Gợi ý cho bạn</h2>
                    </div>
                    <div class="movie-grid" id="suggested-movies"></div>
                `;

                renderMovies(items, "search-results", cdn);

                const hotRes = await fetch("https://phimapi.com/danh-sach/phim-moi-cap-nhat?page=1");
                const hotData = await hotRes.json();
                const hotItems = hotData?.items?.slice(0, 12) || [];
                const hotCdn = hotData?.APP_DOMAIN_CDN_IMAGE || "https://phimimg.com";
                renderMovies(hotItems, "suggested-movies", hotCdn);

                document.getElementById("backHomeBtn").addEventListener("click", resetMainContent);

            } catch (e) {
                console.error("search error", e);
                alert("Lỗi tìm kiếm phim");
            } finally {
                hideLoading();
            }
        }

        // Escape HTML
        function escapeHtml(s) {
            return String(s).replace(/[&<>"']/g, (m) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
        }

        // Movie detail popup
        async function getMovieDetail(slug) {
            if (!slug) return;

            showPopupLoading();
            openPopup();

            try {
                const r = await fetch(`https://phimapi.com/phim/${slug}`);
                const d = await r.json();
                if (!d?.status) {
                    alert("Không tìm thấy thông tin phim");
                    closePopup();
                    return;
                }

                const movie = d.movie || {};
                const episodes = d.episodes?.[0]?.server_data || [];
                const cdnDomain = d?.APP_DOMAIN_CDN_IMAGE || "https://phimimg.com";

                if (movie.titleHead) document.title = movie.titleHead + " | RoPhim";
                if (movie.descriptionHead) {
                    let meta = document.querySelector('meta[name="description"]');
                    if (!meta) {
                        meta = document.createElement("meta");
                        meta.name = "description";
                        document.head.appendChild(meta);
                    }
                    meta.content = movie.descriptionHead;
                }

                const posterUrl = buildImageUrl(movie.poster_url || movie.thumb_url, cdnDomain);
                document.getElementById("moviePoster").src = posterUrl;

                document.getElementById("movieTitle").innerText = `${movie.name || movie.origin_name || "Không tên"} ${movie.year ? "(" + movie.year + ")" : ""}`;

                const genres = (movie.category?.map(c => c.name).join(", ")) || "Không rõ";
                const countries = (movie.country?.map(c => c.name).join(", ")) || "Không rõ";
                const actors = (movie.actor?.join(", ")) || "Không rõ";
                const directors = (movie.director?.join(", ")) || "Không rõ";
                const rating = movie.rating || Math.random() * 5 + 5;
                document.getElementById("movieMeta").innerHTML = `
                    <span><i class="fas fa-star"></i> ${rating.toFixed(1)}/10</span>
                    <span><i class="fas fa-clock"></i> ${movie.time || 'N/A'}</span>
                    <span><i class="fas fa-calendar"></i> ${movie.year || 'N/A'}</span>
                    <span><i class="fas fa-film"></i> ${movie.quality || 'N/A'}</span>
                    <span><i class="fas fa-tags"></i> ${genres}</span>
                    <span><i class="fas fa-globe"></i> ${countries}</span>
                    <span><i class="fas fa-user-friends"></i> Diễn viên: ${actors}</span>
                    <span><i class="fas fa-video"></i> Đạo diễn: ${directors}</span>
                `;

                const descEl = document.getElementById("movieDesc");
                const toggleBtn = document.getElementById("toggleDescBtn");
                const descText = movie.content || "Không có mô tả cho phim này.";
                descEl.textContent = descText;
                descEl.classList.remove("expanded");
                if (descText.length > 220) {
                    toggleBtn.style.display = "inline-block";
                    toggleBtn.textContent = "Xem thêm▼";
                    toggleBtn.onclick = () => {
                        const expanded = descEl.classList.toggle("expanded");
                        toggleBtn.textContent = expanded ? "Thu gọn▲" : "Xem thêm▼";
                    };
                } else {
                    toggleBtn.style.display = "none";
                }

                const epList = document.getElementById("episodeList");
                if (episodes.length > 0) {
                    epList.innerHTML = episodes.map((ep, i) => {
                        const url = ep.link_embed || ep.link || ep.file || "#";
                        return `<button onclick="playEpisode('${url}', this)">Tập ${ep.name || i + 1}</button>`;
                    }).join("");

                    if (episodes[0].link_embed || episodes[0].link || episodes[0].file) {
                        const firstEp = epList.querySelector('button');
                        firstEp.classList.add('active');
                        playEpisode(episodes[0].link_embed || episodes[0].link || episodes[0].file, firstEp);
                    }
                } else {
                    epList.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--muted);">Không có tập nào.</p>';
                }
            } catch (e) {
                console.error("detail error", e);
                alert("Lỗi tải chi tiết phim");
                closePopup();
            } finally {
                hidePopupLoading();
            }
        }

        // Share to social media
        function shareTo(platform) {
            const url = window.location.href;
            const title = document.getElementById('movieTitle').innerText;
            let shareUrl;

            if (platform === 'facebook') {
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            } else if (platform === 'twitter') {
                shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
            }

            window.open(shareUrl, '_blank');
        }

        // Play episode
        function playEpisode(url, element) {
            if (!url || url === "#") return alert("Link không hợp lệ");

            const buttons = document.querySelectorAll('#episodeList button');
            buttons.forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');

            const player = document.getElementById("player");
            player.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;

            setTimeout(() => {
                player.scrollIntoView({ behavior: "smooth", block: "start" });
            }, 100);
        }

        // Show popup loading
        function showPopupLoading() {
            const player = document.getElementById("player");
            player.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
        }

        // Hide popup loading
        function hidePopupLoading() {
            const loading = document.querySelector('#player .loading');
            if (loading) loading.remove();
        }

        // Open popup
        function openPopup() {
            document.body.style.overflow = 'hidden';
            document.getElementById("popup").style.display = "flex";
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Close popup
        function closePopup() {
            document.body.style.overflow = 'auto';
            document.getElementById("player").innerHTML = "";
            document.getElementById("popup").style.display = "none";
            document.title = "RoPhim - Phim hay cả rổ - Xem Phim Mới HD Online Vietsub";
        }
    </script>
</body>
</html>
